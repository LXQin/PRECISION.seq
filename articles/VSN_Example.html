<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRECISION.SEQ Example Usage • precision.seq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PRECISION.SEQ Example Usage">
<meta property="og:description" content="precision.seq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">precision.seq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Intro_Data.html">Introduction to PRECISION.SEQ Data</a>
    </li>
    <li>
      <a href="../articles/Intro_Figure.html">Introduction to PRECISION.SEQ Figure Functions</a>
    </li>
    <li>
      <a href="../articles/Intro_Functions.html">Introduction to PRECISION.SEQ Functions</a>
    </li>
    <li>
      <a href="../articles/VSN_Example.html">PRECISION.SEQ Example Usage</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="VSN_Example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PRECISION.SEQ Example Usage</h1>
            
      
      
      <div class="hidden name"><code>VSN_Example.Rmd</code></div>

    </div>

    
    
<div id="introduction-and-overview" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-and-overview" class="anchor" aria-hidden="true"></a>Introduction and Overview</h1>
<p>In this vignette, we demonstrate an example usage of the PRECISION.SEQ package. We assess the normalization performance of the “variance stabilization”(vsn) normalization method, which is provided by the R package <code>vsn</code>, and compare its performance against other popular normalization methods.</p>
<p>The analysis pipeline works as follows: We first assess evidence of differential expression in the <a href="../reference/data.benchmark.html">benchmark data</a> without normalization using <code>voom</code>. The benchmark data was collected using uniform handling to minimize any handling effects and, hence, differential expression in the benchmark data serves as a “gold standard”. On the other hand, the <a href="../reference/data.test.html">test data</a> contains the same samples as the benchmark data, however it was sequenced over multiple years without careful study design, resulting in unwanted depth variations. We then assess differential expression in the dest data before and after normalization and compare it with the gold standard. The agreement of this comparison in summarized using graphically using various plots, and numerically using measures such as the false negative rate (FNR) and the false discovery rate (FDR). See also <a href="Intro_Data.html">this vignette</a> for more information on the data sets.</p>
<p>For simplicity, all of these steps have been packaged into a simple pipeline consisting of the following 2 steps:</p>
<ol style="list-style-type: decimal">
<li>Normalization of the test data using the normalization method under study.</li>
<li>Application of the <a href="../reference/precision.seq.html"><code>precision.seq</code></a> function.</li>
</ol>
<p>The <a href="../reference/precision.seq.html"><code>precision.seq</code></a> function performs the full normalization assessment and returns a comparison to all included normalization methods.</p>
</div>
<div id="example-usage-for-variance-stabilizing-normalization-vsn" class="section level1">
<h1 class="hasAnchor">
<a href="#example-usage-for-variance-stabilizing-normalization-vsn" class="anchor" aria-hidden="true"></a>Example usage for Variance Stabilizing Normalization (vsn)</h1>
<p>First, we load the PRECISION.SEQ package as well as the Biobase and vsn packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">precision.seq</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biobase" class="external-link">Biobase</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.r-project.org" class="external-link">vsn</a></span><span class="op">)</span></code></pre></div>
<div id="vsn-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#vsn-normalization" class="anchor" aria-hidden="true"></a>VSN Normalization</h2>
<p>The <a href="../reference/data.test.html">test data</a> is normalized by Variance Stabilizing Normalization (VSN) using the function <code>justvsn</code> from the R package <code>vsn</code>. If there are any unwanted negative counts in the normalized data, we set them to 1. Any of the negative normalized counts are set to 1.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vsn.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vsn/man/justvsn.html" class="external-link">justvsn</a></span><span class="op">(</span><span class="va">data.test</span><span class="op">)</span>  <span class="co"># Normalize data</span>
<span class="va">vsn.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">vsn.norm</span><span class="op">&lt;</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="va">vsn.norm</span><span class="op">)</span>  <span class="co"># Handle negative counts</span></code></pre></div>
</div>
<div id="precision-seq-normalization-assessment" class="section level2">
<h2 class="hasAnchor">
<a href="#precision-seq-normalization-assessment" class="anchor" aria-hidden="true"></a>precision.seq Normalization Assessment</h2>
<p>We perform the full PRECISION.SEQ normalization assessment using the <a href="../reference/precision.seq.html"><code>precision.seq</code></a> function. This includes:</p>
<ul>
<li>Normalization of the test data using all included reference normalization methods.</li>
<li>Differential expression analysis using voom or edgeR.</li>
<li>Comparison of the differential expression statuses between the normalized test data and the benchmark data.</li>
<li>Visualization and numerical quantification of the results.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res.vsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/precision.seq.html">precision.seq</a></span><span class="op">(</span><span class="va">vsn.norm</span>, method.name<span class="op">=</span><span class="st">"vsn"</span><span class="op">)</span></code></pre></div>
<p>We investigate some results.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Relative log expression</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.vsn</span><span class="op">$</span><span class="va">p.RLE</span><span class="op">$</span><span class="va">noNorm</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 367 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<p><img src="VSN_Example_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.vsn</span><span class="op">$</span><span class="va">p.RLE</span><span class="op">$</span><span class="va">vsn</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 1465 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<p><img src="VSN_Example_files/figure-html/unnamed-chunk-4-2.png" width="480"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Volcano plot for DE</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.vsn</span><span class="op">$</span><span class="va">p.volcano</span><span class="op">$</span><span class="va">vsn</span><span class="op">)</span></code></pre></div>
<p><img src="VSN_Example_files/figure-html/unnamed-chunk-4-3.png" width="480"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Venn Diagram of DE statuses</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.vsn</span><span class="op">$</span><span class="va">p.venn</span><span class="op">$</span><span class="va">noNorm</span><span class="op">)</span></code></pre></div>
<p><img src="VSN_Example_files/figure-html/unnamed-chunk-4-4.png" width="480"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.vsn</span><span class="op">$</span><span class="va">p.venn</span><span class="op">$</span><span class="va">vsn</span><span class="op">)</span></code></pre></div>
<p><img src="VSN_Example_files/figure-html/unnamed-chunk-4-5.png" width="480"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># FNR-FDR plot</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.vsn</span><span class="op">$</span><span class="va">p.FNR_FDR</span><span class="op">)</span></code></pre></div>
<p><img src="VSN_Example_files/figure-html/unnamed-chunk-4-6.png" width="480"></p>
</div>
<div id="simulation-data-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-data-analysis" class="anchor" aria-hidden="true"></a>Simulation Data Analysis</h2>
<p>Finally, we extend out analysis using simulated data. For a full description of the data simulation algorithm, please refer to the paper <a href="https://pubmed.ncbi.nlm.nih.gov/32598180/" class="external-link"><em>Statistical Assessment of Depth Normalization for Small RNA Sequencing</em></a>.</p>
<div id="data-simulation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-simulation" class="anchor" aria-hidden="true"></a>Data Simulation</h3>
<p>We first sample 100 simulated data sets using the function <a href="../reference/simulated.data.html"><code>simulated.data</code></a>. These new data sets have been simulated in advance and the <code>simulated.data</code> function returns a random subset of these data sets. To filter the total number of 20,000 pairs of test and benchmark data sets, the user can specify two ranges: (1) a range for the proportion of differentially expressed markers, and (2) a range for the median of the mean differences. We set the proportion of differentially expressed markers to 15% to 25%, and the range of the median of mean differences to between 2 to 4. The simulated data sets are of the same size as the test and benchmark data sets, each containing 27 MXF and 27 PMFH samples.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span>

<span class="va">num.sets</span> <span class="op">=</span> <span class="fl">100</span>  <span class="co"># number of data sets</span>
<span class="va">sim.groups</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'MXF'</span>,<span class="fl">27</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'PMFH'</span>,<span class="fl">27</span><span class="op">)</span><span class="op">)</span>  <span class="co"># sample groups</span>

<span class="co"># Get simulated data sets with the specified proportion of differentially </span>
<span class="co"># expressed markers and specified median mean difference</span>
<span class="va">simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulated.data.html">simulated.data</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.25</span><span class="op">)</span>,  
                            median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, 
                            numsets <span class="op">=</span> <span class="va">num.sets</span><span class="op">)</span> </code></pre></div>
</div>
<div id="boxplot-for-fdr-and-fnr" class="section level3">
<h3 class="hasAnchor">
<a href="#boxplot-for-fdr-and-fnr" class="anchor" aria-hidden="true"></a>Boxplot for FDR and FNR</h3>
<p>We normalize each simulated test data set using <code>vsn</code> and all included method. We then compute differential expression by the voom method using the included wrapper function <a href="../reference/DE.voom.html"><code>DE.voom</code></a></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test.norm.list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/pip.norm.html">pip.norm</a></span><span class="op">(</span>raw<span class="op">=</span><span class="va">simulated</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">simulated_test</span>, groups<span class="op">=</span><span class="va">sim.groups</span>, norm.method <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">vsn.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vsn/man/justvsn.html" class="external-link">justvsn</a></span><span class="op">(</span><span class="va">simulated</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">simulated_test</span><span class="op">)</span>
  <span class="va">test.norm.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VSN</span><span class="op">$</span><span class="va">dat.normed</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">vsn.norm</span><span class="op">&lt;</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="va">vsn.norm</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">test.DE.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  TMM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">TMM</span><span class="op">$</span><span class="va">dat.normed</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span>,
  TC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">TC</span><span class="op">$</span><span class="va">dat.normed</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span>,
  UQ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">UQ</span><span class="op">$</span><span class="va">dat.normed</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span>,
  med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">med</span><span class="op">$</span><span class="va">dat.normed</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span>,
  DESeq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">DESeq</span><span class="op">$</span><span class="va">dat.normed</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span>,
  PoissonSeq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PoissonSeq</span><span class="op">$</span><span class="va">dat.normed</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span>,
  QN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">QN</span><span class="op">$</span><span class="va">dat.normed</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span>,
  RUVg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">simulated</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">simulated_test</span>, groups <span class="op">=</span> <span class="va">sim.groups</span>,normalized<span class="op">=</span><span class="cn">FALSE</span>,
                                          adjust<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">RUVg</span><span class="op">$</span><span class="va">adjust.factor</span><span class="op">)</span><span class="op">)</span>,
  RUVs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">simulated</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">simulated_test</span>, groups <span class="op">=</span> <span class="va">sim.groups</span>,normalized<span class="op">=</span><span class="cn">FALSE</span>,
                                          adjust<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">RUVs</span><span class="op">$</span><span class="va">adjust.factor</span><span class="op">)</span><span class="op">)</span>,
  RUVr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">simulated</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">simulated_test</span>, groups <span class="op">=</span> <span class="va">sim.groups</span>, normalized<span class="op">=</span><span class="cn">FALSE</span>,
                                          adjust<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">RUVr</span><span class="op">$</span><span class="va">adjust.factor</span><span class="op">)</span><span class="op">)</span>,
  SVA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">simulated</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">simulated_test</span>, groups <span class="op">=</span> <span class="va">sim.groups</span>,normalized<span class="op">=</span><span class="cn">FALSE</span>,
                                         adjust<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">SVA</span><span class="op">$</span><span class="va">adjust.factor</span><span class="op">)</span><span class="op">)</span>,
  noNorm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">simulated</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">simulated_test</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span>,
  VSN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">test.norm.list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VSN</span><span class="op">$</span><span class="va">dat.normed</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">benchmark.DE.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu"><a href="../reference/DE.voom.html">DE.voom</a></span><span class="op">(</span>RC<span class="op">=</span><span class="va">simulated</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">simulated_benchmark</span>, groups <span class="op">=</span> <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/fig.FDR_FNR.boxplot.html">fig.FDR_FNR.boxplot</a></span><span class="op">(</span><span class="va">test.DE.list</span>, <span class="va">benchmark.DE.list</span>, title <span class="op">=</span> <span class="st">"DE = 20%, median mean-diff = 3"</span><span class="op">)</span></code></pre></div>
<p><img src="VSN_Example_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
</div>
</div>
<div id="example-usage-for-sva-normalization" class="section level1">
<h1 class="hasAnchor">
<a href="#example-usage-for-sva-normalization" class="anchor" aria-hidden="true"></a>Example usage for SVA Normalization</h1>
<p>Some normalization methods compute “adjustment” or “scaling” factors instead of normalized counts. In this case, the input of the  function changes slightly. For illustration, we repeat the PRECISION.SEQ analysis for a method that computes adjusting factors for the normalization. We use the (already included) method “sva”, for which a wrapper function  is provided.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute normalization </span>
<span class="va">sva.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/norm.SVA.html">norm.SVA</a></span><span class="op">(</span><span class="va">data.test</span>, <span class="va">data.group</span><span class="op">)</span>
<span class="co"># sva.norm contains the </span>
<span class="va">res.sva</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/precision.seq.html">precision.seq</a></span><span class="op">(</span><span class="va">sva.norm</span><span class="op">$</span><span class="va">dat.normed</span>, 
                         method.name<span class="op">=</span><span class="st">"sva"</span>, 
                         adjust.factors<span class="op">=</span><span class="va">sva.norm</span><span class="op">$</span><span class="va">adjust.factor</span>, 
                         DE.method<span class="op">=</span><span class="st">"DE.voom"</span>, 
                         Pval<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<!-- Test data is normalized by Variance Stabilizing Normalization (VSN) using function `justvsn`, and the negative normalized values are set to 1. Voom-limma is used for the differential expression analysis. -->
<!-- ```{r} -->
<!-- vsn.norm <- justvsn(data.test) -->
<!-- vsn.norm <- ifelse(vsn.norm<0, 1, vsn.norm) -->
<!-- vsn.pval <- DE.voom(vsn.norm, data.group) -->
<!-- test.norm <- pip.norm(raw=data.test, groups=data.group, norm.method = "all") -->
<!-- test.DE <- list( -->
<!--   TMM = DE.voom(RC=test.norm$TMM$dat.normed, groups = data.group), -->
<!--   TC = DE.voom(RC=test.norm$TC$dat.normed, groups = data.group), -->
<!--   UQ = DE.voom(RC=test.norm$UQ$dat.normed, groups = data.group), -->
<!--   med = DE.voom(RC=test.norm$med$dat.normed, groups = data.group), -->
<!--   DESeq = DE.voom(RC=test.norm$DESeq$dat.normed, groups = data.group), -->
<!--   PoissonSeq = DE.voom(RC=test.norm$PoissonSeq$dat.normed, groups = data.group), -->
<!--   QN = DE.voom(RC=test.norm$QN$dat.normed, groups = data.group), -->
<!--   RUVg = DE.voom(RC=data.test, groups = data.group,normalized=FALSE, adjust=test.norm$RUVg$adjust.factor), -->
<!--   RUVs = DE.voom(RC=data.test, groups = data.group,normalized=FALSE, adjust=test.norm$RUVs$adjust.factor), -->
<!--   RUVr = DE.voom(RC=data.test, groups = data.group, normalized=FALSE, adjust=test.norm$RUVr$adjust.factor), -->
<!--   SVA = DE.voom(RC=data.test, groups = data.group,normalized=FALSE, adjust=test.norm$SVA$adjust.factor), -->
<!--   noNorm = DE.voom(RC=data.test, groups = data.group), -->
<!--   VSN = vsn.pval) -->
<!-- benchmark.DE <- DE.voom(RC=data.benchmark, groups = data.group) -->
<!-- ``` -->
<!-- # Empirical Data Analysis -->
<!-- ## Relative Log Expression Plot -->
<!-- ```{r} -->
<!-- fig.RLE(data.test, data.group, "test without normalization") -->
<!-- fig.RLE(vsn.norm, data.group, "test with VSN normalization") -->
<!-- ``` -->
<!-- ## Scatterplot for FNR and FDR -->
<!-- ```{r} -->
<!-- fig.FDR_FNR(test.DE, benchmark.DE, title = "") -->
<!-- ``` -->
<!-- ## Concordance at The Top Plot -->
<!-- ```{r} -->
<!-- fig.CAT(test.DE, benchmark.DE, title = "") -->
<!-- ``` -->
<!-- ## Dendrogram for clustering p-values -->
<!-- ```{r} -->
<!-- fig.dendrogram(test.DE, title = "") -->
<!-- ``` -->
<!-- # Simulation Data Analysis -->
<!-- ## Data Simulation -->
<!-- ```{r} -->
<!-- set.seed(12345) -->
<!-- sim.groups = c(rep('MXF',27),rep('PMFH',27)) -->
<!-- simulated <- simulated.data(proportion = c(0.15, 0.25),  median = c(2, 4), numsets = 100) -->
<!-- ``` -->
<!-- ## Boxplot for FDR and FNR -->
<!-- ```{r warning = FALSE, message = FALSE, results = FALSE} -->
<!-- test.norm.list = lapply(1:100, function(x) pip.norm(raw=simulated[[x]]$simulated_test, groups=sim.groups, norm.method = "all")) -->
<!-- for (i in 1:100){vsn.norm <- justvsn(simulated[[i]]$simulated_test);test.norm.list[[i]]$VSN$dat.normed = ifelse(vsn.norm<0, 1, vsn.norm)} -->
<!-- test.DE.list <- list( -->
<!--   TMM = lapply(1:100, function(x) DE.voom(RC=test.norm.list[[x]]$TMM$dat.normed, groups = sim.groups)), -->
<!--   TC = lapply(1:100, function(x)DE.voom(RC=test.norm.list[[x]]$TC$dat.normed, groups = sim.groups)), -->
<!--   UQ = lapply(1:100, function(x)DE.voom(RC=test.norm.list[[x]]$UQ$dat.normed, groups = sim.groups)), -->
<!--   med = lapply(1:100, function(x)DE.voom(RC=test.norm.list[[x]]$med$dat.normed, groups = sim.groups)), -->
<!--   DESeq = lapply(1:100, function(x)DE.voom(RC=test.norm.list[[x]]$DESeq$dat.normed, groups = sim.groups)), -->
<!--   PoissonSeq = lapply(1:100, function(x)DE.voom(RC=test.norm.list[[x]]$PoissonSeq$dat.normed, groups = sim.groups)), -->
<!--   QN = lapply(1:100, function(x)DE.voom(RC=test.norm.list[[x]]$QN$dat.normed, groups = sim.groups)), -->
<!--   RUVg = lapply(1:100, function(x)DE.voom(RC=simulated[[x]]$simulated_test, groups = sim.groups,normalized=FALSE, -->
<!--                                           adjust=test.norm.list[[x]]$RUVg$adjust.factor)), -->
<!--   RUVs = lapply(1:100, function(x)DE.voom(RC=simulated[[x]]$simulated_test, groups = sim.groups,normalized=FALSE, -->
<!--                                           adjust=test.norm.list[[x]]$RUVs$adjust.factor)), -->
<!--   RUVr = lapply(1:100, function(x)DE.voom(RC=simulated[[x]]$simulated_test, groups = sim.groups, normalized=FALSE, -->
<!--                                           adjust=test.norm.list[[x]]$RUVr$adjust.factor)), -->
<!--   SVA = lapply(1:100, function(x)DE.voom(RC=simulated[[x]]$simulated_test, groups = sim.groups,normalized=FALSE, -->
<!--                                          adjust=test.norm.list[[x]]$SVA$adjust.factor)), -->
<!--   noNorm = lapply(1:100, function(x)DE.voom(RC=simulated[[x]]$simulated_test, groups = sim.groups)), -->
<!--   VSN = lapply(1:100, function(x)DE.voom(RC=test.norm.list[[x]]$VSN$dat.normed, groups = sim.groups))) -->
<!-- benchmark.DE.list <- lapply(1:100, function(x)DE.voom(RC=simulated[[x]]$simulated_benchmark, groups = sim.groups)) -->
<!-- fig.FDR_FNR.boxplot(test.DE.list, benchmark.DE.list, title = "DE = 20%, median mean-diff = 3") -->
<!-- ``` -->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jian Zou, Yannick Duren, Li-Xuan Qin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
