<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRECISION.SEQ Example Usage • precision.seq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PRECISION.SEQ Example Usage">
<meta property="og:description" content="precision.seq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">precision.seq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Intro_Data.html">Introduction to the Data in PRECISION.seq</a>
    </li>
    <li>
      <a href="../articles/Intro_Figure.html">Introduction to the Plotting Functions in PRECISION.seq</a>
    </li>
    <li>
      <a href="../articles/Intro_Functions.html">Introduction to Normaliztion and Differential Expression Analysis Functions in PRECISION.seq</a>
    </li>
    <li>
      <a href="../articles/p90_Example.html">PRECISION.SEQ Example Usage</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="p90_Example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PRECISION.SEQ Example Usage</h1>
            
      
      
      <div class="hidden name"><code>p90_Example.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>Introduction</h2>
<p>In this vignette, we demonstrate an example usage of functions in the PRECISION.seq package. It assesses the performance of the 90th percentile normalization (p90) method, which normalizes the dataset using the 90th percentile (similar to upper quantile normalization), in comparison with nine other normalization methods.</p>
<p>The analysis pipeline works as follows: We first assess evidence of differential expression in the <a href="../reference/data.benchmark.html">benchmark data</a> without normalization using <code>voom</code>. The benchmark data was collected using uniform handling to minimize any handling effects and, hence, differential expression in the benchmark data serves as a “gold standard”. On the other hand, the <a href="../reference/data.test.html">test data</a> contains the same samples as the benchmark data, however it was sequenced over multiple years without careful study design, resulting in unwanted depth variations. We then assess differential expression in the dest data before and after normalization and compare it with the gold standard. The agreement of this comparison in summarized using graphically using various plots, and numerically using measures such as the false negative rate (FNR) and the false discovery rate (FDR). See also <a href="Intro_Data.html">this vignette</a> for more information on the data sets.</p>
<p>For simplicity, all of these steps have been packaged into a simple pipeline consisting of the following 2 steps:</p>
<ol style="list-style-type: decimal">
<li>Normalization of the test data using the normalization method under study.</li>
<li>Application of the <a href="../reference/precision.seq.html"><code>precision.seq</code></a> function.</li>
</ol>
<p>The <a href="../reference/precision.seq.html"><code>precision.seq</code></a> function performs the full normalization assessment and returns a comparison to all included normalization methods.</p>
</div>
<div id="package-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#package-installation" class="anchor" aria-hidden="true"></a>Package Installation</h2>
<p>First, we load the PRECISION.seq package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">precision.seq</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biobase" class="external-link">Biobase</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioinf.wehi.edu.au/edgeR" class="external-link">edgeR</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="th-percentile-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#th-percentile-normalization" class="anchor" aria-hidden="true"></a>90th Percentile Normalization</h2>
<p>We fist define a function for normalization using the 90th percentile as a scaling factor for each sample. Then the we apply this p90 normalization to the test data in order to later compare it to the noramlization methods provided by the <code>precision.seq</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">percentile_90_norm</span>  <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raw</span>, <span class="va">groups</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">dat.DGE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/DGEList.html" class="external-link">DGEList</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">raw</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span>,
                     group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span>,
                     genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">raw</span><span class="op">)</span><span class="op">)</span>
  <span class="va">q.factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">dat.DGE</span><span class="op">$</span><span class="va">counts</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span>, probs <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>
  <span class="va">scaling.factor</span> <span class="op">&lt;-</span> <span class="va">q.factor</span><span class="op">/</span><span class="fl">1e6</span>
  <span class="va">dat.normed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">raw</span><span class="op">)</span><span class="op">/</span><span class="va">scaling.factor</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dat.normed</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">percentile.norm</span> <span class="op">&lt;-</span> <span class="fu">percentile_90_norm</span><span class="op">(</span><span class="va">data.test</span>, <span class="va">data.group</span><span class="op">)</span></code></pre></div>
</div>
<div id="performance-assessment-of-90th-percentile-normalization-using-empirical-data" class="section level2">
<h2 class="hasAnchor">
<a href="#performance-assessment-of-90th-percentile-normalization-using-empirical-data" class="anchor" aria-hidden="true"></a>Performance Assessment of 90th Percentile Normalization using Empirical Data</h2>
<p>We assess the performance of p90 using the <a href="../reference/precision.seq.html"><code>precision.seq</code></a> function. It includes (1) normalization of the test data using p90 and nine other normalization methods that are implemented in the package, (2) differential expression analysis using voom or edgeR for the normalized data and for the unnormalized benchmark data, (3) comparison of the differential expression statuses between the normalized test data and the benchmark data, and (4) graphical display and numerical summary of the comparison.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res.p90</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/precision.seq.html">precision.seq</a></span><span class="op">(</span><span class="va">percentile.norm</span>, method.name<span class="op">=</span><span class="st">"p90"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Relative log expression</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.p90</span><span class="op">$</span><span class="va">p.RLE</span><span class="op">$</span><span class="va">noNorm</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 367 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<p><img src="p90_Example_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.p90</span><span class="op">$</span><span class="va">p.RLE</span><span class="op">$</span><span class="va">p90</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 1993 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<p><img src="p90_Example_files/figure-html/unnamed-chunk-4-2.png" width="480"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Volcano plot for DE</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.p90</span><span class="op">$</span><span class="va">p.volcano</span><span class="op">$</span><span class="va">p90</span><span class="op">)</span></code></pre></div>
<p><img src="p90_Example_files/figure-html/unnamed-chunk-4-3.png" width="480"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Venn Diagram of DE statuses</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.p90</span><span class="op">$</span><span class="va">p.venn</span><span class="op">$</span><span class="va">noNorm</span><span class="op">)</span></code></pre></div>
<p><img src="p90_Example_files/figure-html/unnamed-chunk-4-4.png" width="480"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.p90</span><span class="op">$</span><span class="va">p.venn</span><span class="op">$</span><span class="va">p90</span><span class="op">)</span></code></pre></div>
<p><img src="p90_Example_files/figure-html/unnamed-chunk-4-5.png" width="480"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># FNR-FDR plot</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res.p90</span><span class="op">$</span><span class="va">p.FNR_FDR</span><span class="op">)</span></code></pre></div>
<p><img src="p90_Example_files/figure-html/unnamed-chunk-4-6.png" width="480"></p>
</div>
<div id="performance-assessment-of-p90-normalization-using-simulated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#performance-assessment-of-p90-normalization-using-simulated-data" class="anchor" aria-hidden="true"></a>Performance Assessment of p90 Normalization using Simulated Data</h2>
<p>The assessment is extended to simulated data reflecting various patterns of differential expression. For a full description of the simulation algorithm, please refer to the paper <a href="https://pubmed.ncbi.nlm.nih.gov/32598180/" class="external-link"><em>Statistical Assessment of Depth Normalization for Small RNA Sequencing</em></a>.</p>
<div id="extract-simulated-data" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-simulated-data" class="anchor" aria-hidden="true"></a>Extract Simulated Data</h3>
<p>20,000 simulated pairs of test data and benchmark data sets were generated in advance. The user can specify: (1) a range for the proportion of differentially expressed markers, and (2) a range for the median of the mean differences, and use the function <a href="../reference/simulated.data.html"><code>simulated.data</code></a> to extract the simulated data set pairs that fall into these two ranges. In the example shown here, the proportion of differentially expressed markers is set to 15% to 25% and the range of the median of mean differences is set to between 2 to 4.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span>

<span class="va">num.sets</span> <span class="op">=</span> <span class="fl">100</span>  <span class="co"># number of data sets</span>
<span class="va">sim.groups</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'MXF'</span>,<span class="fl">27</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'PMFH'</span>,<span class="fl">27</span><span class="op">)</span><span class="op">)</span>  <span class="co"># sample groups</span>

<span class="co"># Get simulated data sets with the specified proportion of differentially </span>
<span class="co"># expressed markers and specified median mean difference</span>
<span class="va">simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulated.data.html">simulated.data</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.25</span><span class="op">)</span>,  
                            median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, 
                            numsets <span class="op">=</span> <span class="va">num.sets</span><span class="op">)</span> </code></pre></div>
</div>
<div id="boxplot-for-fdr-and-fnr" class="section level3">
<h3 class="hasAnchor">
<a href="#boxplot-for-fdr-and-fnr" class="anchor" aria-hidden="true"></a>Boxplot for FDR and FNR</h3>
<p>Each simulated test data set is normalized with 90th percentile. The pipeline function <a href="../reference/pip.simulated.data.html"><code>pip.simulated.data</code></a> is then used to compute the agreement of differential expression statuses for simulated test data set with that for its paired simulated benchmark data set.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p90.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num.sets</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">p90.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">p90.norm</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">percentile_90_norm</span><span class="op">(</span><span class="va">simulated</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">simulated_test</span>, <span class="va">sim.groups</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 
<span class="op">}</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pip.simulated.data.html">pip.simulated.data</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">simulated</span>, groups<span class="op">=</span><span class="va">sim.groups</span>, norm.counts<span class="op">=</span><span class="va">p90.norm</span>, method.name<span class="op">=</span><span class="st">"p90"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">p.boxplot</span><span class="op">)</span></code></pre></div>
<p><img src="p90_Example_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jian Zou, Yannick Duren, Li-Xuan Qin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.9000.9000.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
